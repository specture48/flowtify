# Flowtify

`Flowtify` is a flexible and robust TypeScript library for defining and executing workflows. It supports sequential and parallel steps, compensation handling, dependency injection, and nested workflows. It is designed to be extensible, type-safe, and easy to use.

---

## Features

- **Sequential and Parallel Steps:** Execute steps in sequence or concurrently.
- **Compensation Handling:** Automatically undo steps if a workflow fails.
- **Nested Workflows:** Compose workflows by embedding one workflow as a step within another.
- **Dependency Injection:** Integrates with `Awilix` for resolving dependencies.
- **Dynamic Input Resolution:** Resolve step inputs dynamically from the workflow context.
- **Type Safety:** Built with TypeScript for type-safe workflows.
- **Error Handling:** Fail-fast behavior with proper error propagation.
- **Extensibility:** Add custom step types and containers.

---

## Installation

Install the package using npm or yarn:

```bash
npm install flowtify
```

or

```bash
yarn add flowtify
```

---

## Usage

### Basic Example

```typescript
// Define the steps
const createUserStep: WorkflowStep<{ username: string; email: string }, any> = {
    execute: async (input) => {
        // Simulate user creation
        const user = {
            id: "user-123", // In a real scenario, this would be generated by your system
            username: input.username,
            email: input.email,
        };
        console.log("User created:", user);
        return user;
    },
    compensate: async (output) => {
        // Simulate user deletion (compensation)
        console.log("User deleted:", output);
    },
};

const createUserProfileStep: WorkflowStep<{ userId: string; bio: string; avatarUrl: string }, any> = {
    execute: async (input) => {
        // Simulate user profile creation
        const userProfile = {
            userId: input.userId,
            bio: input.bio,
            avatarUrl: input.avatarUrl,
        };
        console.log("User profile created:", userProfile);
        return userProfile;
    },
    compensate: async (output) => {
        // Simulate user profile deletion (compensation)
        console.log("User profile deleted:", output);
    },
};

// Create the workflow
const workflow = new WorkflowBuilder()
    .addStep("createUser", createUserStep, (context) => ({
        username: context.input.username,
        email: context.input.email,
    }))
    .addStep("createUserProfile", createUserProfileStep, (context) => ({
        userId: context.createUser.id, // Use the output from the previous step
        bio: context.input.bio,
        avatarUrl: context.input.avatarUrl,
    }));

    const input = {
        username: "john_doe",
        email: "john.doe@example.com",
        bio: "Software Engineer",
        avatarUrl: "https://example.com/avatar.jpg",
    };

    const result = await workflow.execute(input);
    console.log("Workflow result:", result);


```
---

## API Reference

### `WorkflowBuilder<TInput, TOutput>`

- **`addStep(key: string, step: WorkflowStep, inputResolver?: (context: WorkflowContext) => any)`**
    - Adds a sequential step to the workflow.
    - `key`: A unique identifier for the step.
    - `step`: The step definition (must include an `execute` method and optionally a `compensate` method).
    - `inputResolver`: A function to dynamically resolve the step's input from the context.

- **`addParallel(steps: Record<string, WorkflowStep>, inputResolvers?: Record<string, (context: WorkflowContext) => any>)`**
    - Adds parallel steps to the workflow.
    - `steps`: A key-value pair of step definitions.
    - `inputResolvers`: A key-value pair of input resolver functions for each step.

- **`runAsStep(key: string, inputResolver?: (context: WorkflowContext) => any)`**
    - Converts the workflow into a step that can be used in another workflow.
    - `key`: A unique identifier for the nested workflow.
    - `inputResolver`: A function to dynamically resolve the nested workflow's input from the context.

- **`execute(input: TInput): Promise<TOutput>`**
    - Executes the workflow and returns the final output.
    - `input`: The initial input for the workflow.

---

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

## Support

If you encounter any issues or have questions, please [open an issue](https://github.com/specture48/flowtify/issues) on GitHub.

---

## Acknowledgments

- Inspired by workflow patterns in distributed systems and event-driven architectures.

---